import java.awt.Point;
import java.util.Scanner;
import java.util.ArrayList;
import java.util.Iterator;

/**
 * ########### ### ###### #####.
 *
 * #### ###### ###### ### ## #### ########### ############ ### 
 * ### #### ## #########, #### #### ###### ## ####### #### ## 
 * ### ################### ##############. 
 */
public class SnakeSpiel {
  private Schlange schlange;
  private Tuer tuer;
  private Spielfeld spielfeld;
  private Point goldStueck;
  private ArrayList<GoldStueck> goldStuecke;
  private boolean spielLaeuft = true;

  /**
   * Startet das Spiel.
   */
  public void spielen(int anzahlGoldStuecke) {
    spielInitialisieren(anzahlGoldStuecke);
    while (spielLaeuft) {
      zeichneSpielfeld();
      ueberpruefeSpielstatus();
      fuehreSpielzugAus();
    }   
  }
  
  public static void main(String[] args) {
    new SnakeSpiel().spielen(10);
  }

  private void spielInitialisieren(int anzahlGoldStuecke) {
    tuer = new Tuer(0, 5);
    spielfeld = new Spielfeld(40, 10);
    goldStueck = new Point(20, 2);
    goldStuecke = new ArrayList<GoldStueck>();
    setAnzahlGoldStuecke(anzahlGoldStuecke);
    schlange = new Schlange(30, 2);
  }
  
  private void setAnzahlGoldStuecke(int anzahlGoldStuecke) {
      if (anzahlGoldStuecke < 1) anzahlGoldStuecke = 10;
      for (int i = 0; i < anzahlGoldStuecke; i++) {
          goldStuecke.add(new GoldStueck(spielfeld.erzeugeZufallspunktInnerhalb()));
        }
    }

  private void zeichneSpielfeld() {
    char ausgabeZeichen;
    for (int y = 0; y < spielfeld.gibHoehe(); y++) {
      for (int x = 0; x < spielfeld.gibBreite(); x++) {
        Point punkt = new Point(x, y);
        ausgabeZeichen = '.';
        if (schlange.istAufPunkt(punkt)) {
          ausgabeZeichen = '@';
        } else if (istEinGoldstueckAufPunkt(punkt)) {
          ausgabeZeichen = '$';
        } else if (tuer.istAufPunkt(punkt)) {
          ausgabeZeichen = '#';
        } 
        if(schlange.istKopfAufPunkt(punkt)) {
          ausgabeZeichen = 'S';         
        }
        System.out.print(ausgabeZeichen);
      }
      System.out.println();
    }
  }
  
  private boolean istEinGoldstueckAufPunkt(Point punkt) {
      
      for (GoldStueck goldStueck : goldStuecke) {
          if (goldStueck != null && goldStueck.istAufPunkt(punkt)) return true;
        }
      return false;
  }
  
  private void ueberpruefeSpielstatus() {
    if (istEinGoldstueckAufPunkt(schlange.gibPosition())) {
      goldStueck = null;
      Iterator<GoldStueck> it = goldStuecke.iterator();
      while (it.hasNext()) {
          GoldStueck g = it.next();
          if (g.istAufPunkt(schlange.gibPosition()) it.remove();
        }
      schlange.wachsen();
      System.out.println("Goldstueck eingesammelt.");
    }
    if (istVerloren()){
      System.out.println("Verloren!");
      spielLaeuft = false;
    }
    if (istGewonnen()){
      System.out.println("Gewonnen!");
      spielLaeuft = false;
    }
  }
  
  private boolean istGewonnen() {
    return goldStueck == null && 
      tuer.istAufPunkt(schlange.gibPosition());
  }

  private boolean istVerloren() {
    return schlange.istKopfAufKoerper() || 
         !spielfeld.istPunktInSpielfeld(schlange.gibPosition());
  }
  
  private void fuehreSpielzugAus() {
    char eingabe = liesZeichenVonTastatur();
    schlange.bewege(eingabe);
  }

  private char liesZeichenVonTastatur() {
    Scanner scanner = new Scanner(System.in);
    char konsolenEingabe = scanner.next().charAt(0);
    return konsolenEingabe;
  }
}